!function(t){function e(t,s,n){if(0!==n.length){var r=n.shift(),i=t.replace(r[0],r[1]);""===r[0]||i!==t?chrome.dictionary.translate(i,function(r){void 0===r||""===r?e(t,s,n):s.resolve(r)}):e(t,s,n)}else s.reject()}function s(t){var s=new l;return e(t,s,h.concat()),s}function n(t){return t=t.toLowerCase(),t=t.replace(/[‘’′´]/g,"'"),(t=t.replace(/[–‑—‒]/g,"-")).replace(/^[¡!¿?“”‛‟‚„″˝…\x20-\x40\x5b-\x60\x7b-\x7e]+|[¡!¿?“”‛‟‚„″˝…\x20-\x40\x5b-\x60\x7b-\x7e]+$/g,"")}function r(t,e,r){var c=t.text;if(t&&!t.notify){var o=n(c),l=u.getEntry(o);if(l)i(l,r,null);else{if(o.match(/^[a-z\-\']+$/i)){var h=s(o),f=new Date;return h.fail(function(){i({text:o,originalText:c,error:"NOT_FOUND"},r,{start:f},e)}).success(function(t){i({text:o,originalText:c,translation:a(t)},r,{start:f},e)}),!0}i({text:o,originalText:c,error:"NOT_SUPPORTED_PHRASES"},r,null)}}else i({originalText:c,error:"NOTIFY"},r,null)}function i(t,e,s,n){var r=t.error;Boolean(t.text)&&u.saveEntry(t.text,t),o(!r),e&&e(t),Boolean(s)&&chrome.tabs.detectLanguage(n,function(t){if(s.start){e=r?"WordUnsuccessfulLookup":"WordSuccessfullLookup";metrics.recordTime(e,new Date-s.start)}if(t){var e=c(t)?"EnPageTranslation":"NotEnPageTranslation",n=r?metrics.TRANSLATION_UNSUCCESSFUL:metrics.TRANSLATION_SUCCESSFULL;metrics.recordSmallCount(e,n)}})}function a(t){var e;for(var s in f)e=f[s],t=t.replace(e,s);return'<div class="corom-scroll">'+t+"</div>"}function c(t){return"en"===t.substr(0,2).toLowerCase()}function o(t){chrome.contextMenus.update(_,{enabled:t})}var l=function(t){if(0===arguments.length)return this._init(),this;if(t instanceof l)return t;var e=new l;return e.resolve(t),e};l.RUNNING=0,l.RESOLVED=1,l.FAILED=2,l.prototype={constructor:l,_init:function(){this._results=[],this._subscribers=[],this.state=l.RUNNING},_notify:function(){var t=this;this._subscribers.forEach(function(e){e.apply(t,t._results)}),this._subscribers=[]},resolve:function(){return this.state=l.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=l.FAILED,this._results=arguments,this._notify(),this},subscribe:function(t){this.state!==l.RUNNING?t.apply(this,this._results):this._subscribers.push(t)},done:function(t){return this.subscribe(t),this},success:function(t){var e=this;return this.subscribe(function(){e.state===l.RESOLVED&&t.apply(e,e._results)}),this},fail:function(t){var e=this;return this.subscribe(function(){e.state===l.FAILED&&t.apply(e,e._results)}),this},bind:function(t){return(t=new l(t)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},l.when=function(){var t=[];return t=Array.isArray(arguments[0])?arguments[0]:Utils.toArray(arguments),new l.When(t)},l.When=function(t){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=l.RUNNING,this._thingsToDo=t.length,this._results=Array(this._thingsToDo),this._init(t)},l.When.prototype={constructor:l.When,_init:function(t){var e=this;t.forEach(function(t,s){(t=new l(t)).subscribe(function(){t.state===l.FAILED&&(e._state=l.FAILED),e._results[s]=Utils.toArray(arguments),e._thingsToDo--,e._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var t=[];this._results.forEach(function(e){t=t.concat(e)}),this._state===l.FAILED?this._runCallbacks(this._failCallbacks,t):this._runCallbacks(this._successCallbacks,t),this._runCallbacks(this._doneCallbacks,t),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(t,e){t.forEach(function(t){t.apply(this,e)})},done:function(t){return this._doneCallbacks.push(t),this._checkIsDone(),this},success:function(t){return this._successCallbacks.push(t),this._checkIsDone(),this},fail:function(t){return this._failCallbacks.push(t),this._checkIsDone(),this}},l.chain=function(){function t(e){if(!e.length)return s.resolve.apply(s,n);var r=e.shift();"function"==typeof r?l(r()).done(function(s){n.push(s),t(e)}):(n.push(r),t(e))}var e,s=new l,n=[];return e=Array.isArray(arguments[0])?arguments[0]:Utils.toArray(arguments),t(e),s},window.Promise=l,chrome.metricsPrivate||(chrome.metricsPrivate={recordSmallCount:console.warn.bind(console,"Metrics.recordCount:"),recordTime:console.warn.bind(console,"Metrics.recordTime:")}),Object.keys(chrome.metricsPrivate).forEach(function(t){var e=chrome.metricsPrivate[t];chrome.metricsPrivate[t]=function(){var t=Array.prototype.slice.call(arguments);return t[0]="Dictionary."+t[0],e.apply(this,t)}}),window.metrics=chrome.metricsPrivate,metrics.POPUP_OPENED_SELECTION=0,metrics.POPUP_OPENED_DOUBLECLICK=1,metrics.POPUP_OPENED_CONTEXTMENU=2,metrics.TRANSLATION_UNSUCCESSFUL=0,metrics.TRANSLATION_SUCCESSFULL=1;var u={_lastKey:null,_lastEntry:null,saveEntry:function(t,e){this._lastKey=t,this._lastEntry=e},getEntry:function(t){return t===this._lastKey?this._lastEntry:null}},h=[["",""],[new RegExp("^([^']+)'?s$",""),"$1"],[/^(.*)ies$/,"$1y"],[/^(.*)ed$/,"$1"],[/^(.*)ed$/,"$1e"],[/^(.*)ing$/,"$1e"],[/^(.*)ying$/,"$1ie"],[/^(.*)ing$/,"$1"],[/^(.*e)r$/,"$1"],[/^(.*e)st$/,"$1"]];chrome.dictionary&&chrome.dictionary.translate||("object"!=typeof DICT&&(DICT={}),chrome.dictionary={translate:function(t,e){setTimeout(function(){e(DICT[t])},10*Math.random())}});var f={"\n":/\\n/gm,'<div class="corom-ref">– xem $1</div>':/XEMBEGIN[^@]*(@.*)$/gm,"":/XEMEND/gm,'<div class="corom-transcript">$1</div>':/(\/[^\/]+\/)/gm,'<div class="corom-word">$1</div>':/@(.*)$/gm,'<div class="corom-part">$1</div>':/^\*(.*)$/gm,'<div class="corom-meaning">$1</div>':/^-(.*)$/gm,'<div class="corom-example">$1</div>':/^=(.*)$/gm,'<div class="corom-phrase">$1</div>':/^!(.*)$/gm};chrome.runtime.onMessage.addListener(function(t,e,s){switch(t.type){case"on_selection":return r(t.data,e.tab.id,s);case"close_popups":chrome.tabs.sendMessage(e.tab.id,{type:"close_popup"});break;case"report_small_count":metrics.recordSmallCount(t.name,t.value);break;case"report_time":metrics.recordTime(t.name,t.value);break;case"disable_menu":o(!1);break;case"current_tab":s({tab:e.tab});break;case"get_language":if(!e||!e.tab||!e.tab.id)return;return chrome.tabs.detectLanguage(e.tab.id,function(t){s(chrome.runtime.lastError?{lang:"un"}:{lang:t})}),!0;case"is_panel":var n=-1===e.tab.index&&e.tab.active;s({isPanel:n})}});var _=chrome.contextMenus.create({title:chrome.i18n.getMessage("context_menu_translate"),contexts:["selection"],enabled:!1});chrome.contextMenus.onClicked.addListener(function(t,e){e&&e.id&&t.menuItemId==_&&r({text:t.selectionText,notify:!1},e.id,function(t){chrome.tabs.sendMessage(e.id,{type:"on_context_menu",data:t})})}),chrome.tabs.onActivated.addListener(function(){o(!1)})}("undefined"==typeof global?global={}:global);