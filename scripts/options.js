!function(t){function e(t){for(var e=this;e&&(!e.matches||!e.matches(t));)e=e.parentNode;return e}var n={};n.query=function(t){return 0==t.indexOf("#")?document.getElementById(t.substring(1)):null},Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),n.getNearest=function(t,n){return e.call(t,n)},n.getElement=function(t){for(;t&&1!==t.nodeType;)t=t.parentNode;return t},n.thouShallNotPass=function(t){return t.preventDefault(),t.stopPropagation(),!1},n.noop=function(){},"undefined"==typeof PRODUCTION&&(n.throttle=function(t,e){var n,s=null;return function(){s?n=arguments:(n=arguments,s=setTimeout(function(){return s=null,t.apply(this,n)},e))}},n.html=function(t){var e=document.createElement(t.tag||"keke");if(t.style)for(var n in t.style)e.style[n]=t.style[n];return t.text&&(e.textContent=t.text),e}),window.Utils=n;var s=function(t){if(0===arguments.length)return this._init(),this;if(t instanceof s)return t;var e=new s;return e.resolve(t),e};s.RUNNING=0,s.RESOLVED=1,s.FAILED=2,s.prototype={constructor:s,_init:function(){this._results=[],this._subscribers=[],this.state=s.RUNNING},_notify:function(){var t=this;this._subscribers.forEach(function(e){e.apply(t,t._results)}),this._subscribers=[]},resolve:function(){return this.state=s.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=s.FAILED,this._results=arguments,this._notify(),this},subscribe:function(t){this.state!==s.RUNNING?t.apply(this,this._results):this._subscribers.push(t)},done:function(t){return this.subscribe(t),this},success:function(t){var e=this;return this.subscribe(function(){e.state===s.RESOLVED&&t.apply(e,e._results)}),this},fail:function(t){var e=this;return this.subscribe(function(){e.state===s.FAILED&&t.apply(e,e._results)}),this},bind:function(t){return(t=new s(t)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},s.when=function(){var t=[];return t=Array.isArray(arguments[0])?arguments[0]:n.toArray(arguments),new s.When(t)},s.When=function(t){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=s.RUNNING,this._thingsToDo=t.length,this._results=Array(this._thingsToDo),this._init(t)},s.When.prototype={constructor:s.When,_init:function(t){var e=this;t.forEach(function(t,i){(t=new s(t)).subscribe(function(){t.state===s.FAILED&&(e._state=s.FAILED),e._results[i]=n.toArray(arguments),e._thingsToDo--,e._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var t=[];this._results.forEach(function(e){t=t.concat(e)}),this._state===s.FAILED?this._runCallbacks(this._failCallbacks,t):this._runCallbacks(this._successCallbacks,t),this._runCallbacks(this._doneCallbacks,t),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(t,e){t.forEach(function(t){t.apply(this,e)})},done:function(t){return this._doneCallbacks.push(t),this._checkIsDone(),this},success:function(t){return this._successCallbacks.push(t),this._checkIsDone(),this},fail:function(t){return this._failCallbacks.push(t),this._checkIsDone(),this}},s.chain=function(){function t(e){if(!e.length)return i.resolve.apply(i,r);var n=e.shift();"function"==typeof n?s(n()).done(function(n){r.push(n),t(e)}):(r.push(n),t(e))}var e,i=new s,r=[];return e=Array.isArray(arguments[0])?arguments[0]:n.toArray(arguments),t(e),i},window.Promise=s;var i=function(){this._storage=chrome.storage.local,this._options={},this._default={double_click_translate_enabled:!0,input_translate_enabled:!0,double_click_input_translate_enabled:!1};var t=this;chrome.storage.onChanged.addListener(function(e,n){if("local"===n)for(var s in e)t._options[s]=e[s].newValue}),this.isTranslateEnabled=function(e){return"input"!==e||t.get("input_translate_enabled")},this.isDoubleClickTranslateEnabled=function(e){return!!t.isTranslateEnabled(e)&&("input"===e?t.get("double_click_input_translate_enabled"):t.get("double_click_translate_enabled"))}};i.prototype={load:function(){var t=new s,e=this;return this._storage.get(null,function(n){e._options=n,t.resolve(n)}),t},set:function(t,e){var n={};"string"!=typeof t&&"number"!=typeof t||void 0===e||(n[t]=e,this._options[t]=e,this._storage.set(n))},get:function(t){return t in this._options?this._options[t]:this._default[t]}},window.Options=i,chrome.metricsPrivate||(chrome.metricsPrivate={recordSmallCount:console.warn.bind(console,"Metrics.recordCount:"),recordTime:console.warn.bind(console,"Metrics.recordTime:")}),Object.keys(chrome.metricsPrivate).forEach(function(t){var e=chrome.metricsPrivate[t];chrome.metricsPrivate[t]=function(){var t=Array.prototype.slice.call(arguments);return t[0]="Dictionary."+t[0],e.apply(this,t)}}),window.metrics=chrome.metricsPrivate,metrics.POPUP_OPENED_SELECTION=0,metrics.POPUP_OPENED_DOUBLECLICK=1,metrics.POPUP_OPENED_CONTEXTMENU=2,metrics.TRANSLATION_UNSUCCESSFUL=0,metrics.TRANSLATION_SUCCESSFULL=1;var r,o=chrome.i18n.getMessage;chrome.storage?(r=new i,metrics=chrome.extension.getBackgroundPage().metrics):r={double_click_translate_enabled:!0,input_translate_enabled:!0,double_click_input_translate_enabled:!1,get:function(t){return this[t]},load:function(){return{done:function(t){t()}}},set:function(){console.log("set",arguments[0],"to",arguments[1])}},r.load().done(function(){function t(){var t={isDoubleClickTranslateEnabled:r.get("double_click_translate_enabled"),isInInputTranslateEnabled:r.get("input_translate_enabled"),isDoubleClickInInputTranslateEnabled:r.get("double_click_input_translate_enabled"),i18n_options_title:o("options_title"),i18n_double_click_translate:o("options_double_click_translate"),i18n_input_translate:o("options_input_translate"),i18n_double_click_input_translate:o("options_double_click_input_translate")},s=n.query("#options-template").textContent;e.innerHTML=Mustache.render(s,t)}var e=n.query("#options");t(),e.addEventListener("click",function(t){var e=t.target;switch("close-button"===e.id&&window.close(),e.getAttribute("id")){case"double-click-translate":r.set("double_click_translate_enabled",!!e.checked);break;case"input-translate":r.set("input_translate_enabled",!!e.checked),n.query("#input-translate-details").classList[e.checked?"remove":"add"]("disabled");break;case"double-click-input-translate":r.set("double_click_input_translate_enabled",!!e.checked)}},!1),window.addEventListener("focus",function(){t()},!1)})}("undefined"==typeof global?global={}:global);